<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Soroban ‚Äî —Å—Ç–∏–ª—å + –∑–≤—É–∫ (–∞–∫–∫—É—Ä–∞—Ç–Ω–æ)</title>
<style>
  :root{--bg:#F4F5FB;--wood2:#8B5A2B;--rod:#7A5533;--text:#4a3b2f}
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  h1{margin:6px 0 12px;font-size:22px;color:var(--wood2);text-align:center}
  .panel{display:flex;gap:12px;justify-content:center;align-items:center;flex-wrap:wrap;margin:8px 0 12px}
  .board{position:relative;width:100%;aspect-ratio:16/6;background:#f7f6fb;border-radius:24px;box-shadow:0 8px 24px rgba(0,0,0,.12)}
  svg{position:absolute;inset:0;width:100%;height:100%;display:block}
  /* –¥–µ—Ä–µ–≤–æ */
  .rail{fill:url(#woodGrad);filter:drop-shadow(0 4px 8px rgba(0,0,0,.25))}
  .beam{fill:url(#woodGrad);filter:drop-shadow(0 3px 6px rgba(0,0,0,.25))}
  /* —Å–ø–∏—Ü—ã */
  .rod{stroke:var(--rod);stroke-width:12;stroke-linecap:round;opacity:.95}
  /* –±—É—Å–∏–Ω—ã */
  .bead{cursor:pointer;touch-action:manipulation}
  .bead-oval{fill:url(#beadGrad);filter:drop-shadow(0 4px 5px rgba(0,0,0,.26))}
  .bead-emoji{dominant-baseline:middle;text-anchor:middle;filter:drop-shadow(0 2px 2px rgba(0,0,0,.2))}
  /* –∫–æ–Ω—Ç—Ä–æ–ª—ã */
  select{padding:8px 10px;border:1px solid #dad7ee;border-radius:10px;background:#fff}
  .sound{display:flex;gap:6px;align-items:center;background:#fff;border:1px solid #e8e6f2;border-radius:10px;padding:6px 8px}
</style>
</head>
<body>
<div class="wrap">
  <h1>Soroban (–∫–ª–∞—Å—Å–∏–∫–∞) ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ç–∏–ª—å –∏ –∑–≤—É–∫</h1>
  <div class="panel">
    <label>–°—Ç–∏–ª—å:
      <select id="styleSelect" aria-label="–í—ã–±–æ—Ä —Å—Ç–∏–ª—è">
        <option value="classic" selected>–ë—É—Å–∏–Ω—ã</option>
        <option value="üçì">üçì –ö–ª—É–±–Ω–∏–∫–∞</option>
        <option value="‚öΩ">‚öΩ –ú—è—á</option>
        <option value="üçé">üçé –Ø–±–ª–æ–∫–æ</option>
        <option value="üßÅ">üßÅ –ü–∏—Ä–æ–∂–Ω–æ–µ</option>
        <option value="üçî">üçî –ë—É—Ä–≥–µ—Ä</option>
      </select>
    </label>
    <label class="sound"><input id="soundChk" type="checkbox" checked> –ó–≤—É–∫</label>
  </div>

  <div class="board" role="img" aria-label="–ê–±–∞–∫—É—Å">
    <svg id="svg" viewBox="0 0 1600 600" preserveAspectRatio="xMidYMid meet">
      <defs>
        <linearGradient id="woodGrad" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#C58B55"/><stop offset="100%" stop-color="#8B5A2B"/>
        </linearGradient>
        <radialGradient id="beadGrad" cx="35%" cy="30%" r="65%">
          <stop offset="0%" stop-color="#FFE3B8"/><stop offset="45%" stop-color="#FFA542"/><stop offset="100%" stop-color="#D36F17"/>
        </radialGradient>
        <!-- –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ–±–ª–∞—Å—Ç—å ‚Äî –æ–±—Ä–µ–∑–∞–µ—Ç —ç–º–æ–¥–∑–∏, —á—Ç–æ–±—ã –Ω–µ —Ç–æ—Ä—á–∞–ª–∏ –∑–∞ —Ä–∞–º–æ–π -->
        <clipPath id="innerClip">
          <rect x="90" y="40" width="1420" height="520" rx="10" ry="10"/>
        </clipPath>
      </defs>
    </svg>
  </div>
</div>

<script>
(function(){
  const svg = document.getElementById('svg');
  const styleSelect = document.getElementById('styleSelect');
  const soundChk = document.getElementById('soundChk');

  // —Ä–∞–∑–º–µ—Ä—ã –∏ –≥–µ–æ–º–µ—Ç—Ä–∏—è (–ø–æ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ)
  const W=1600,H=600, padX=90,padY=40, sepY=290;
  const beadR=36, beadRX=beadR+8;         // –æ–≤–∞–ª—å–Ω–∞—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ñ–æ—Ä–º–∞
  const emojiScale=1.65;                  // —É–º–µ–Ω—å—à–∏–ª–∏ —ç–º–æ–¥–∑–∏, —á—Ç–æ–±—ã –Ω–µ ¬´–ª–µ–∑–ª–∏¬ª
  const earthGap=84;                      // —á—É—Ç—å –ø–ª–æ—Ç–Ω–µ–µ
  const rods=13;

  let cols=[], style='classic';
  try{ const s=localStorage.getItem('sorobanStyle'); if(s) style=s; }catch(e){}

  // –ø—Ä–æ—Å—Ç–æ–π ¬´—â—ë–ª–∫¬ª
  let ac=null;
  function clickSound(){
    if(!soundChk.checked) return;
    try{
      if(!ac) ac=new (window.AudioContext||window.webkitAudioContext)();
      const o=ac.createOscillator(), g=ac.createGain();
      o.type='square'; o.frequency.value=900; g.gain.value=0.045;
      o.connect(g); g.connect(ac.destination); o.start(); setTimeout(()=>o.stop(),28);
    }catch(e){}
  }

  function rails(parent){
    parent.appendChild(rect(padX,padY,W-2*padX,26,'rail'));
    parent.appendChild(rect(padX,H-padY-26,W-2*padX,26,'rail'));
    parent.appendChild(rect(padX-20,padY,20,H-2*padY,'rail'));
    parent.appendChild(rect(W-padX,padY,20,H-2*padY,'rail'));
  }
  function rect(x,y,w,h,cls){const r=doc('rect'); r.setAttribute('x',x); r.setAttribute('y',y);
    r.setAttribute('width',w); r.setAttribute('height',h); r.setAttribute('rx',12); r.setAttribute('ry',12);
    r.setAttribute('class',cls); return r;}
  function line(x1,x2,y1,y2,cls){const l=doc('line'); l.setAttribute('x1',x1); l.setAttribute('x2',x2);
    l.setAttribute('y1',y1); l.setAttribute('y2',y2); l.setAttribute('class',cls); return l;}
  function doc(n){return document.createElementNS('http://www.w3.org/2000/svg',n);}

  function makeBead(cx,cy,onTap){
    const g=doc('g'); g.setAttribute('class','bead');
    g.addEventListener('click',onTap,false);
    g.addEventListener('touchend',e=>{e.preventDefault();onTap();},false);

    const oval=doc('ellipse');
    oval.setAttribute('cx',cx); oval.setAttribute('cy',cy);
    oval.setAttribute('rx',beadRX); oval.setAttribute('ry',beadR);
    oval.setAttribute('class','bead-oval');

    const text=doc('text');
    text.setAttribute('x',cx);
    text.setAttribute('y',cy + 1);          // –º–µ–ª–∫–∏–π —Å–¥–≤–∏–≥ –¥–ª—è –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
    text.setAttribute('class','bead-emoji');
    text.style.fontSize = (beadR*emojiScale)+'px';
    text.textContent='üçì';

    g.appendChild(oval); g.appendChild(text);
    return g;
  }

  function init(){
    while(svg.firstChild) svg.removeChild(svg.firstChild);

    // —Å–ª–æ–π, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø—Ä–∏–º–µ–Ω—è–µ–º –∫–ª–∏–ø
    const inner = doc('g'); inner.setAttribute('clip-path','url(#innerClip)'); svg.appendChild(inner);

    // –Ω–∏–∑ —Ä–∞–º–∫–∏ –∏ –ø–µ—Ä–µ–∫–ª–∞–¥–∏–Ω–∞ ‚Äî –≤–Ω—É—Ç—Ä–∏ –∫–ª–∏–ø–∞
    rails(inner);
    inner.appendChild(rect(padX,sepY-10,W-2*padX,20,'beam'));

    const innerW=W-2*padX, gap=(rods>1)? innerW/(rods-1):0;
    cols=[];
    for(let i=0;i<rods;i++){
      const cx=padX+i*gap;
      inner.appendChild(line(cx,cx,padY+2,H-padY-2,'rod'));
      const col={heaven:0,earth:[0,0,0,0],cx,beads:[]}; cols.push(col);

      const hRest=padY+46, hActive=sepY-52;
      const hb=makeBead(cx,hRest,()=>{col.heaven=col.heaven?0:1; clickSound(); updateCol(col);});
      inner.appendChild(hb); col.beads.push({el:hb,kind:'heaven',rest:hRest,active:hActive});

      for(let j=0;j<4;j++){
        const eRest=sepY+48+j*earthGap, eActive=sepY+22+j*14;
        const eb=makeBead(cx,eRest,()=>{col.earth[j]=col.earth[j]?0:1; clickSound(); updateCol(col);});
        inner.appendChild(eb); col.beads.push({el:eb,kind:'earth',idx:j,rest:eRest,active:eActive});
      }
      updateCol(col);
    }

    // –≤–µ—Ä—Ö —Ä–∞–º–∫–∏ –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ ‚Äî –∫—Ä–∞—Å–∏–≤–æ ¬´–æ–±—Ä–µ–∑–∞–µ—Ç¬ª
    rails(svg);

    styleSelect.value=style;
    applyStyle();
  }

  function updateCol(col){
    for(const b of col.beads){
      const y = (b.kind==='heaven') ? (col.heaven ? b.active : b.rest)
                                    : (col.earth[b.idx] ? b.active : b.rest);
      const g=b.el, oval=g.children[0], text=g.children[1];
      oval.setAttribute('cx',col.cx);  oval.setAttribute('cy',y);
      text.setAttribute('x',col.cx);   text.setAttribute('y',y+1);
    }
  }

  function applyStyle(){
    style = styleSelect.value;
    try{ localStorage.setItem('sorobanStyle', style);}catch(e){}
    for(const col of cols){
      for(const b of col.beads){
        const g=b.el, oval=g.children[0], text=g.children[1];
        if(style==='classic'){ oval.style.display='block'; text.style.display='none'; }
        else { oval.style.display='none'; text.style.display='block'; text.textContent=style; }
      }
    }
  }

  styleSelect.addEventListener('change',applyStyle,false);
  init();
})();
</script>
</body>
</html>
